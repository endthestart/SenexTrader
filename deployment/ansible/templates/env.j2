# Environment configuration for Senex Trader ({{ django_env | upper }})
# Generated by Ansible - DO NOT EDIT MANUALLY
# Generated: {{ ansible_date_time.iso8601 }}

# =============================================================================
# Container Environment
# =============================================================================
ENVIRONMENT={{ django_env }}
CONTAINER_MODE=true
APP_DIR={{ app_directory }}

# Container Image Configuration
GITEA_REGISTRY={{ gitea_registry }}
IMAGE_NAME={{ image_name }}
IMAGE_TAG={{ image_tag }}

# =============================================================================
# Django Core Settings
# =============================================================================
DJANGO_SETTINGS_MODULE=senextrader.settings.{{ django_env }}
ALLOWED_HOSTS={{ allowed_hosts }}
WS_ALLOWED_ORIGINS={{ ws_allowed_origins }}
APP_BASE_URL={{ app_base_url }}

# =============================================================================
# HashiCorp Vault Configuration (Secrets Management)
# =============================================================================
# When configured, Django fetches secrets from Vault at startup instead of
# using the environment variables below. This keeps encryption keys off disk.
{% if vault_addr is defined %}
VAULT_ADDR={{ vault_addr }}
{% if vault_role_id is defined %}
VAULT_ROLE_ID={{ vault_role_id }}
VAULT_SECRET_ID={{ vault_secret_id }}
{% elif vault_token is defined %}
VAULT_TOKEN={{ vault_token }}
{% endif %}
{% endif %}

# =============================================================================
# Fallback Secrets (used if Vault not configured)
# =============================================================================
# These are written for backwards compatibility but Django will prefer Vault
SECRET_KEY={{ secret_key }}
FIELD_ENCRYPTION_KEY={{ field_encryption_key }}

# SSL Configuration (nginx handles SSL termination, disable Django SSL redirect)
{% if django_env == 'production' or django_env == 'staging' %}
SECURE_SSL_REDIRECT=False
{% endif %}

# =============================================================================
# Database Configuration (PostgreSQL 18)
# =============================================================================
DB_NAME={{ db_name | default('senextrader') }}
DB_USER={{ db_user | default('senex_user') }}
DB_PASSWORD={{ db_password }}
DB_HOST=postgres
DB_PORT=5432

# =============================================================================
# Redis Configuration (Redis 8.2)
# =============================================================================
# Redis is used for:
# - DB 0: Django cache
# - DB 1: Django Channels (WebSocket)
# - DB 2: Celery broker
# - DB 3: Celery result backend
REDIS_URL=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/2
CELERY_RESULT_BACKEND=redis://redis:6379/3

# Django Channels (WebSocket)
CHANNELS_REDIS_URL=redis://redis:6379/1

# =============================================================================
# TastyTrade API Configuration
# =============================================================================
TASTYTRADE_CLIENT_ID={{ tastytrade_client_id }}
TASTYTRADE_CLIENT_SECRET={{ tastytrade_client_secret }}
TASTYTRADE_SCOPES={{ tastytrade_scopes | default('read trade openid') }}

# =============================================================================
# Optional Settings
# =============================================================================
{% if log_level is defined %}
LOG_LEVEL={{ log_level }}
{% endif %}

{% if sentry_dsn is defined %}
SENTRY_DSN={{ sentry_dsn }}
{% endif %}

{% if email_backend is defined %}
# Email Configuration
EMAIL_BACKEND={{ email_backend }}
EMAIL_HOST={{ email_host | default('smtp.gmail.com') }}
EMAIL_PORT={{ email_port | default(587) }}
EMAIL_USE_TLS={{ email_use_tls | default('true') }}
EMAIL_HOST_USER={{ email_host_user | default('') }}
EMAIL_HOST_PASSWORD={{ email_host_password | default('') }}
DEFAULT_FROM_EMAIL={{ default_from_email | default('noreply@example.com') }}
ADMIN_EMAIL={{ admin_email | default('admin@example.com') }}
SERVER_EMAIL={{ server_email | default('errors@example.com') }}
{% endif %}
